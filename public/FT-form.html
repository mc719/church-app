<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CHRIST EMBASSY — Welcome Form (Electronic)</title>
  <style>
    /* =========================
       FIXED FORM (Always same)
       ========================= */
    :root{
      --blue:#1f5fa8;
      --blue-dark:#1b5595;
      --blue-light:#2d75c7;
      --gold:#d6b34a;
      --paper:#f6f7fb;
      --ink:#233245;
      --muted:#5b728e;
      --line:#7fa6d3;
      --line2:#b7cbe3;
      --red:#b23a2c;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:#e7eef8;
      font-family: Arial, Helvetica, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color:var(--ink);
      display:grid;
      place-items:center;
      padding:18px;
    }

    /* Fixed A4-ish canvas */
    .sheet{
      width: 794px;   /* ~A4 @ 96dpi */
      height: 1123px; /* ~A4 @ 96dpi */
      background: var(--paper);
      position:relative;
      box-shadow: 0 14px 40px rgba(10,30,60,.22);
      border-radius: 6px;
      overflow:hidden;
    }

    @media print{
      body{background:white; padding:0}
      .sheet{box-shadow:none; border-radius:0; width:210mm; height:297mm;}
      .actions{display:none !important}
    }

    /* =========================
       BORDER (matches photo vibe)
       ========================= */
    .border-outer{position:absolute; inset:14px; border:6px solid var(--blue); border-radius:4px; pointer-events:none;}
    .border-inner{position:absolute; inset:26px; border:2px solid #ffffffcc; border-radius:3px; pointer-events:none;}
    .border-line{position:absolute; inset:32px; border:2px solid #2c6fb8aa; border-radius:2px; pointer-events:none;}

    /* Zig band top/bottom */
    .zig{
      position:absolute;
      left: 32px; right: 32px;
      height: 18px;
      pointer-events:none;
      opacity:.95;
      background:
        linear-gradient(135deg, transparent 75%, var(--gold) 76%) 0 0/18px 18px repeat-x,
        linear-gradient(225deg, transparent 75%, var(--gold) 76%) 0 0/18px 18px repeat-x,
        linear-gradient(135deg, transparent 75%, var(--blue) 76%) 9px 0/18px 18px repeat-x,
        linear-gradient(225deg, transparent 75%, var(--blue) 76%) 9px 0/18px 18px repeat-x;
      filter: drop-shadow(0 1px 0 rgba(0,0,0,.05));
    }
    .zig.top{ top: 32px; }
    .zig.bottom{ bottom: 32px; transform: rotate(180deg); }

    /* =========================
       CONTENT
       ========================= */
    .content{
      position:absolute;
      inset: 52px 52px 52px 52px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    /* Header grid to keep it “form-like” */
    .header{
      display:grid;
      grid-template-columns: 90px 1fr 90px;
      align-items:start;
      margin-top: 6px;
    }

    /* Real logo box (top-left) */
    .logo{
      width: 78px;
      height: 78px;
      justify-self:start;
      border-radius: 6px;
      background:#f2f6ff;
      border:1px solid #cbdaf0;
      display:grid;
      place-items:center;
      overflow:hidden;
    }
    .logo img{
      width: 70px;
      height: 70px;
      object-fit: contain;
      display:block;
      filter: drop-shadow(0 1px 0 rgba(0,0,0,.12));
    }

    .headtext{text-align:center; padding-top:4px;}
    .headtext .h1{font-weight:800; letter-spacing:.7px; color:var(--blue); font-size:30px; line-height:1.05;}
    .headtext .h2{font-weight:800; color:var(--blue-light); font-size:22px; margin-top:4px;}
    .headtext .p{
      margin:10px auto 0;
      max-width: 610px;
      font-size: 12.8px;
      line-height: 1.35;
      color: var(--muted);
    }
    .headtext .p strong{color:var(--blue); font-weight:800;}
    .note{ text-align:center; font-size:12.8px; color:var(--blue-light); font-style:italic; margin-top:4px; }
    .prompt{ text-align:center; font-size:12.8px; color:var(--muted); margin-top:2px; }
    .hr{ height:1px; background:#c7d7ee; margin: 4px 0 6px; }

    /* =========================
       FORM ELEMENTS
       ========================= */
    form{flex:1; display:flex; flex-direction:column; gap:10px;}

    .row{display:flex; align-items:flex-end; gap:10px; flex-wrap:wrap;}
    .label{color:var(--blue); font-weight:700; font-size:13.5px; min-width:max-content;}
    .line{
      flex:1;
      min-width: 200px;
      border:none;
      border-bottom:2px solid var(--line);
      background:transparent;
      padding:4px 6px 3px;
      font-size:14px;
      outline:none;
    }
    .line:focus{border-bottom-color:var(--blue-light); box-shadow:0 2px 0 rgba(45,117,199,.18);}

    .two{display:grid; grid-template-columns: 1fr 1fr; gap: 10px 18px;}

    .checks{display:flex; align-items:center; gap:22px; margin-left:6px;}
    .check{display:flex; align-items:center; gap:8px; font-size:13.5px; color:var(--muted);}
    input[type="checkbox"], input[type="radio"]{width:14px; height:14px; accent-color:var(--blue-light); cursor:pointer;}

    .section-title{font-weight:800; font-size:13.5px; color:var(--ink); margin-top:2px;}
    .spaced{justify-content:space-between; width:100%; gap:12px;}
    .inline-group{display:flex; align-items:center; gap:14px; flex-wrap:wrap;}
    .smalllabel{color:var(--muted); font-weight:700; font-size:13.2px;}

    .turnover{
      margin-top:auto;
      text-align:center;
      color:var(--red);
      font-weight:900;
      letter-spacing:.2px;
      font-size:14px;
      padding-top:6px;
    }

    .actions{
      display:flex;
      justify-content:center;
      gap:12px;
      margin-top:10px;
      padding-top:10px;
      border-top:1px dashed #b9cde7;
    }
    button{
      border:none;
      border-radius:10px;
      padding:12px 18px;
      font-weight:800;
      cursor:pointer;
      font-size:14px;
      min-width:140px;
    }
    .primary{color:#fff; background:linear-gradient(180deg,var(--blue-light),var(--blue-dark)); box-shadow:0 10px 20px rgba(31,95,168,.22);}
    .secondary{background:#fff; color:var(--blue); border:2px solid rgba(31,95,168,.35);}

    /* Prayer request: 3 “printed lines” but still editable */
    .prayer{margin-top:4px; display:flex; flex-direction:column; gap:12px;}
    .prayer .line{min-width: 100%;}

    /* =========================
       Small screens: scale (no reflow)
       ========================= */
    @media (max-width: 860px){
      .sheet{
        transform: scale(calc((100vw - 36px) / 794));
        transform-origin: top left;
        height: calc(1123px * ( (100vw - 36px) / 794 ));
      }
      body{place-items:start;}
    }
  </style>
</head>

<body>
  <div class="sheet" role="document" aria-label="Christ Embassy Welcome Form">
    <div class="border-outer"></div>
    <div class="border-inner"></div>
    <div class="border-line"></div>
    <div class="zig top"></div>
    <div class="zig bottom"></div>

    <div class="content">
      <div class="header">
        <!-- ✅ Your real logo -->
        <!-- Put the PNG file beside this HTML and name it: loveworld.png -->
        <div class="logo" aria-label="LoveWorld logo">
          <img src="loveworld.png" alt="LoveWorld Logo" />
        </div>

        <div class="headtext">
          <div class="h1">CHRIST EMBASSY</div>
          <div class="h2">Welcome FORM!</div>

          <div class="p"><strong>We</strong> are most delighted to have <strong>YOU</strong> in our midst today.</div>
          <div class="p">
            By completing this form, you consent to our processing of your personal information for your
            church attendance and participation in our ministry programs.
          </div>

          <div class="note">Please complete and tick as appropriate</div>
        </div>

        <div></div>
      </div>

      <div class="prompt">In your own words, kindly express your thoughts about today's service.</div>
      <div class="hr"></div>

      <form id="welcomeForm" novalidate>
        <div class="row">
          <div class="label">Gender:</div>
          <div class="checks" role="group" aria-label="Gender">
            <label class="check"><input type="radio" name="gender" value="Male"> Male</label>
            <label class="check"><input type="radio" name="gender" value="Female"> Female</label>
          </div>
        </div>

        <div class="two">
          <div class="row">
            <div class="label">Name:</div>
            <input class="line" name="name" autocomplete="given-name" />
          </div>

          <div class="row">
            <div class="label">Surname</div>
            <input class="line" name="surname" autocomplete="family-name" />
          </div>

          <div class="row" style="grid-column:1 / -1;">
            <div class="label">Address:</div>
            <input class="line" name="address" autocomplete="street-address" />
          </div>

          <div class="row" style="grid-column:1 / -1; justify-content:flex-end;">
            <div class="label" style="min-width:auto;">Post Code</div>
            <input class="line" name="postcode" style="max-width:230px; min-width:230px;" autocomplete="postal-code"/>
          </div>

          <div class="row" style="grid-column:1 / -1;">
            <div class="label">Mobile Number</div>
            <input class="line" name="mobile" inputmode="tel" autocomplete="tel" />
          </div>

          <div class="row" style="grid-column:1 / -1;">
            <div class="label">Email</div>
            <input class="line" name="email" type="email" autocomplete="email" />
          </div>

          <div class="row" style="grid-column:1 / -1;">
            <div class="label">Birthday</div>
            <input class="line" name="birthday" />
          </div>
        </div>

        <div class="row spaced">
          <div class="inline-group">
            <div class="label">Age Group:</div>
            <label class="check"><input type="radio" name="age_group" value="13-19"> 13-19</label>
            <label class="check"><input type="radio" name="age_group" value="20-35"> 20-35</label>
            <label class="check"><input type="radio" name="age_group" value="36-45"> 36-45</label>
            <label class="check"><input type="radio" name="age_group" value="46&above"> 46&amp;above</label>
          </div>

          <div class="inline-group">
            <div class="label">Marital Status</div>
            <label class="check"><input type="radio" name="marital_status" value="Married"> Married</label>
            <label class="check"><input type="radio" name="marital_status" value="Single"> Single</label>
          </div>
        </div>

        <div class="row spaced">
          <div class="inline-group">
            <div class="label">Are you born again?</div>
            <label class="check"><input type="radio" name="born_again" value="Yes"> Yes</label>
            <label class="check"><input type="radio" name="born_again" value="No"> No</label>
          </div>

          <div class="inline-group">
            <div class="label">Do you speak in tongues?</div>
            <label class="check"><input type="radio" name="speak_tongues" value="Yes"> Yes</label>
            <label class="check"><input type="radio" name="speak_tongues" value="No"> No</label>
          </div>
        </div>

        <div class="section-title">How did you find out about Christ Embassy?</div>
        <div class="row" style="gap:18px;">
          <label class="check"><input type="checkbox" name="find_out" value="TV"> TV</label>
          <label class="check"><input type="checkbox" name="find_out" value="SOCIAL MEDIA"> SOCIAL MEDIA</label>
          <label class="check"><input type="checkbox" name="find_out" value="A CHRIST EMBASSY PROGRAM"> A CHRIST EMBASSY PROGRAM</label>
          <label class="check"><input type="checkbox" name="find_out" value="PERSONAL INVITATION"> PERSONAL INVITATION</label>
        </div>

        <div class="row">
          <div class="smalllabel">Name of Person that Invited you:</div>
          <input class="line" name="invited_by" />
        </div>

        <div class="section-title">Please tell us how you prefer to be contacted</div>
        <div class="row" style="gap:28px;">
          <label class="check"><input type="checkbox" name="contact_pref" value="Telephone"> Telephone</label>
          <label class="check"><input type="checkbox" name="contact_pref" value="SMS"> SMS</label>
          <label class="check"><input type="checkbox" name="contact_pref" value="Post"> Post</label>
          <label class="check"><input type="checkbox" name="contact_pref" value="Email"> Email</label>
        </div>

        <div class="row" style="gap:14px;">
          <div class="smalllabel">Would you like us to visit you?</div>
          <label class="check"><input type="radio" name="visit" value="Yes"> Yes</label>
          <label class="check"><input type="radio" name="visit" value="No"> No</label>
          <div class="smalllabel">If yes, when is most convenient?</div>
          <input class="line" name="visit_when" style="min-width:260px; max-width:320px;" />
        </div>

        <div class="section-title" style="margin-top:6px;">Please list any Prayer Request that you may have</div>
        <div class="prayer">
          <input class="line" name="prayer_1" aria-label="Prayer request line 1" />
          <input class="line" name="prayer_2" aria-label="Prayer request line 2" />
          <input class="line" name="prayer_3" aria-label="Prayer request line 3" />
        </div>

        <div class="turnover">KINDLY TURN OVER ➜</div>

        <div class="actions">
          <button class="primary" type="submit">Submit</button>
          <button class="secondary" type="button" id="cancelBtn">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const form = document.getElementById('welcomeForm');
    const cancelBtn = document.getElementById('cancelBtn');
    const API_BASE = window.location.origin;
    let accessCode = '';

    async function verifyAccessCode() {
      while (!accessCode) {
        const entered = window.prompt('Enter access code to continue:');
        if (entered === null) {
          if (window.history.length > 1) window.history.back();
          else window.close();
          return false;
        }

        try {
          const response = await fetch(`${API_BASE}/api/access/verify`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ accessCode: entered.trim() })
          });
          const data = await response.json().catch(() => ({}));
          if (!response.ok) {
            alert(data.error || 'Invalid access code');
            continue;
          }
          accessCode = entered.trim();
          return true;
        } catch {
          alert('Unable to verify access code. Check your connection and try again.');
        }
      }
      return true;
    }

    function collectFormData() {
      const fd = new FormData(form);
      const data = {};
      for (const [k, v] of fd.entries()) {
        if (data[k] !== undefined) {
          data[k] = Array.isArray(data[k]) ? [...data[k], v] : [data[k], v];
        } else {
          data[k] = v;
        }
      }
      return data;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!accessCode) {
        const ok = await verifyAccessCode();
        if (!ok) return;
      }

      const data = collectFormData();
      const fullName = [data.name, data.surname].filter(Boolean).join(' ').trim();
      if (!fullName || !data.mobile) {
        alert('Name, surname and mobile are required.');
        return;
      }

      const payload = {
        name: data.name || '',
        surname: data.surname || '',
        gender: data.gender || '',
        mobile: data.mobile || '',
        email: data.email || '',
        address: data.address || '',
        postcode: data.postcode || '',
        birthday: data.birthday || '',
        ageGroup: data.age_group || '',
        maritalStatus: data.marital_status || '',
        bornAgain: data.born_again || null,
        speakTongues: data.speak_tongues || null,
        findOut: data.find_out || [],
        invitedBy: data.invited_by || '',
        contactPref: data.contact_pref || [],
        visit: data.visit || null,
        visitWhen: data.visit_when || '',
        prayerRequests: [data.prayer_1, data.prayer_2, data.prayer_3].filter(Boolean),
        dateJoined: new Date().toISOString().slice(0, 10),
        status: 'amber',
        foundationSchool: 'Not Yet',
        cellId: ''
      };

      try {
        const response = await fetch(`${API_BASE}/api/first-timers`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-ACCESS-CODE': accessCode
          },
          body: JSON.stringify(payload)
        });
        const result = await response.json().catch(() => ({}));
        if (!response.ok) {
          throw new Error(result.error || 'Failed to submit form');
        }
        alert(`Submitted successfully for ${fullName}.`);
        form.reset();
      } catch (error) {
        alert(error.message || 'Failed to submit form');
      }
    });

    cancelBtn.addEventListener('click', () => {
      if (confirm("Cancel and clear the form?")) form.reset();
    });

    verifyAccessCode();
  </script>
</body>
</html>
